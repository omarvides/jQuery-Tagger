(function(a,b,c){a.fn.tagger=function(b){function d(a,b){return a.separator.charCodeAt(0)==b}function e(a,b){return a.separator.charAt(0)==b.charAt(0)}function f(a,b){if(b.acceptedTagRegex!=c)return b.acceptedTagRegex.test(a);else if(b.rejectedTagRegex!=c)return!b.rejectedTagRegex.test(a);else return true}function g(b,d,e,g){if(d.limit==c||e.parent().find("span."+d.tagClass).length<d.limit){if(b!=c&&b!=""){if(f(b,d)){var h=a("<a class='"+d.closeClass+"'>"+d.closeChar+"</a>").click(function(){a(this).parent().remove();g.val(g.val().replace(b+",",""))});var i=c,j="";if(d.useColorFunction)i=d.colorFunction(b);var k=a("<span class='"+d.tagClass+"'>"+b+"</span>").append(h);if(i!=c)k.css({color:i.font,"background-color":i.background});k.insertBefore(e);e.next().val(b+d.separator+e.next().val());d.tagPlacedCallback(k,b)}else{d.rejectedTagCallback(e,b)}}}else{d.limitReachedCallback()}}var h=a.extend({},a.fn.tagger.defaults,b);return this.each(function(){var b=a(this);var c=b.attr("name");b.attr("name","tagger_old_"+c);var f=a("<input type='hidden' name='"+c+"' />");var i=a("<div class='"+h.taggerWrapperClass+"'></div>");i.css("width",h.width);b.replaceWith(i);i.append(b).append(f);i.click(function(){b.focus()});var j=b.val();var k="";for(var l=0;l<j.length;l++){if(e(h,j.charAt(l))){k=a.trim(k);g(k,h,b,f);k=""}else{k+=j.charAt(l);if(l==j.length-1){k=a.trim(k);g(k,h,b,f);k=""}}}b.val("");for(var l=0;l<h.startWith.length;l++)g(h.startWith[l],h,b,f);var m=false;b.keypress(function(b){var c=a(this);if(d(h,b.which)){var e=a.trim(a(this).val());e=e.substr(0,e.length);g(e,h,c,f);c.val("");return false}return true});b.keydown(function(b){if(b.which==8){if(a.trim(a(this).val())!="")return true;if(a(this).prev().length>0){$rtag=a(this).prev().find("a").trigger("click")}return false}if(b.which==13){var c=a.trim(a(this).val());c=c.substr(0,c.length);g(c,h,a(this),f);a(this).val("");return false}return true})})};a.fn.tagger.defaults={separator:",",width:"100%",useColorFunction:true,colorFunction:function(a){return{font:"#333",background:"#CCC"}},startWith:new Array,closeChar:"x",tagClass:"tag",taggerWrapperClass:"tagger-input-container",closeClass:"close",tagPlacedCallback:function(a,b){},rejectedTagCallback:function(a,b){},limitReachedCallback:function(){},acceptedTagRegex:c,rejectedTagRegex:c,limit:c}})(jQuery,window)